<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>LLaMA ì±—ë´‡</title>
  <style>
    body { font-family: sans-serif; padding: 20px; background: #f9f9f9; }
    #chatbox { border: 1px solid #ccc; padding: 10px; height: 400px; overflow-y: scroll; background: #fff; }
    .msg { margin: 5px 0; }
    .user { color: blue; font-weight: bold; }
    .bot { color: green; font-weight: bold; }
    .btn { margin: 2px; padding: 5px 10px; }
  </style>
</head>
<body>
  <h1>ğŸ¤– LLaMA ì›¹ ì±—ë´‡</h1>

  <div>
    <label>ğŸ§  ì—­í•  ì„ íƒ: </label>
    <button class="btn" onclick="setRole('default')">í•œêµ­ì¸</button>
    <button class="btn" onclick="setRole('friend')">ì¹œêµ¬</button>
    <button class="btn" onclick="setRole('foreign')">ì™¸êµ­ì¸</button>
    <button class="btn" onclick="setRole('developer')">ê°œë°œì</button>
  </div>

  <div>
    <label>ğŸ“„ ìš”ì•½ ëª¨ë“œ: </label>
    <input type="checkbox" id="summarizeToggle" onchange="toggleSummarize()" />
  </div>

  <!-- âœ… RAG ì²´í¬ë°•ìŠ¤ ì¶”ê°€ -->
  <div>
    <label>ğŸ“š RAG ì‚¬ìš©: </label>
    <input type="checkbox" id="ragToggle" onchange="toggleRAG()" />
  </div>

  <div id="chatbox"></div>

  <input type="text" id="input" placeholder="ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”..." style="width: 80%;" />
  <button onclick="sendMessage()">ë³´ë‚´ê¸°</button>

  <script>
    const chatbox = document.getElementById("chatbox");
    const input = document.getElementById("input");
    let history = [];
    let role = "default";
    let summarize = false;
    let rag = false; // âœ… RAG ìƒíƒœ ë³€ìˆ˜

    function setRole(r) {
      role = r;
      chatbox.innerHTML += `<div class="msg"><em>ğŸ’¡ ì—­í• ì´ '${r}'ë¡œ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤.</em></div>`;
    }

    function toggleSummarize() {
      summarize = document.getElementById("summarizeToggle").checked;
      const status = summarize ? "ON" : "OFF";
      chatbox.innerHTML += `<div class="msg"><em>ğŸ“„ ìš”ì•½ ëª¨ë“œê°€ ${status} ìƒíƒœì…ë‹ˆë‹¤.</em></div>`;
    }

    function toggleRAG() {
      rag = document.getElementById("ragToggle").checked;
      const status = rag ? "ON" : "OFF";
      chatbox.innerHTML += `<div class="msg"><em>ğŸ“š RAG ëª¨ë“œê°€ ${status} ìƒíƒœì…ë‹ˆë‹¤.</em></div>`;
    }

    async function sendMessage() {
      const message = input.value;
      if (!message) return;

      chatbox.innerHTML += `<div class="msg user">ğŸ‘¤ ë‚˜: ${message}</div>`;
      chatbox.scrollTop = chatbox.scrollHeight;
      input.value = "";

      const response = await fetch("/chat", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ message, history, role, summarize, rag })  // âœ… RAG í¬í•¨
      });

      const data = await response.json();
      chatbox.innerHTML += `<div class="msg bot">ğŸ¤– ì±—ë´‡: ${data.response}</div>`;
      chatbox.scrollTop = chatbox.scrollHeight;

      history.push({ role: "user", content: message });
      history.push({ role: "assistant", content: data.response });
    }

    input.addEventListener("keyup", (e) => {
      if (e.key === "Enter") sendMessage();
    });
  </script>
</body>
</html>
